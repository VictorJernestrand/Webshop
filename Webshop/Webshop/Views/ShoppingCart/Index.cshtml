@model IEnumerable<ShoppingCartModel>
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}
@{
    ViewData["Title"] = "Din Varukorg";
}


@if (TempData["LoginNeeded"] != null)

{
    <div class="alert alert-warning" role="alert">
        @TempData["LoginNeeded"] Klick <a asp-action="Login" asp-controller="User">här</a> för logga in
    </div>
}

@if (Model != null && Model.Count() > 0)
{

    <table class="table" id="CartContent" style="color:white">
        @foreach (var product in Model)
        {
            <tr id="DumpCrap_@product.ShoppingCartId">
                <td>
                    <a asp-action="ProductDetail" asp-controller="Product" asp-route-id="@product.ProductId">
                        <img src="@Url.Content("~/Image/" + product.Photo)" style="height: 80px; width: auto" />
                    </a>
                </td>
                <td>@product.Name</td>
                <td>
                    @if (product.Discount == 0)
                    {
                        @product.Price.ToString("C0")
                    }
                    else
                    {
                        <span style="text-decoration: line-through">@product.Price.ToString("C0")</span>
                        <span>@product.DiscountPrice.ToString("C0")</span>
                    }
                </td>

                <td>
                    @if (@product.Amount == 0)
                    {
                        <button class="btn btn-warning" onclick="RemoveCrapFromCart(@product.ShoppingCartId, @product.ProductId)" id="DecreaseBtn_@product.ProductId" disabled><i class="fas fa-minus-square"></i></button>
                    }
                    else
                    {
                        <button class="btn btn-warning" onclick="RemoveCrapFromCart(@product.ShoppingCartId, @product.ProductId)" id="DecreaseBtn_@product.ProductId"><i class="fas fa-minus-square"></i></button>
                    }
                </td>
                <td class="productCounter" id="cartProductId_@product.ProductId">@product.Amount</td>
                <td><button class="btn btn-success" onclick="AddCrapToCart(@product.ProductId, null)" id="IncreaseBtn_@product.ProductId"><i class="fas fa-plus-square"></i></button></td>
                <td><button class="btn btn-outline-danger" onclick="DeleteCrapFromCart(@product.ShoppingCartId)"><i class="fas fa-dumpster-fire"></i></button></td>
            </tr>
        }
    </table>
    <div style="display: none" id="AntiForgeryToken">@GetAntiXsrfRequestToken()</div>
    <div>

    </div>

    <a class="btn btn-warning" asp-controller="Product" asp-action="AllProducts">Fortsätt Shoppa snålis</a>
    @if (Model.Any(x => x.Amount > 0))
    {
        <button class="btn btn-success" id="CashOut" onclick="location.href = '/order'">Gå till kassan</button>
    }
    else
    {
        <button class="btn btn-success" id="CashOut" onclick="location.href = '/order'" disabled>Gå till kassan</button>
        }
    }
else
{
    <div class="alert alert-warning" role="alert">
        Din varuvagn är tom
    </div>
}