@model List<AllProductsViewModel>
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}

@{
    ViewData["Title"] = "Rock★Start";
    int i = 0;
    int a = 0;
}

<partial name="_AddToCartMessagePartial" />

<div id="rockstart-carousel" class="carousel slide rounded d-flex align-items-md-center mt-5 mb-5 p-2" data-ride="carousel" data-interval="2000" >
    <ol class="carousel-indicators">

        @foreach (var x in Model)
        {
            @if (x.Discount > 0)
            {
                var active = (i == 0) ? "class=\"active\"" : "";
                <li data-target="#rockstart-carousel" data-slide-to="@i" @Html.Raw(active)></li>
                i++;
            }
        }
    </ol>

    <div class="carousel-inner">

        @foreach (var product in Model)
        {

            if (product.Discount > 0)
            {
                var active = (a == 0) ? "active" : "";
                a++;

                <div class="carousel-item @active">
                    <div class="row">
                        <div class="col-sm-12 col-md-8 col-lg-7 d-flex justify-content-center justify-content-md-end align-items-center rounded overflow-hidden">
                            <div id="carousel_product" class="shadow">
                                <a asp-controller="Product" asp-action="ProductDetail" asp-route-id="@product.Id">
                                    <img src="@Url.Content("~/Image/" + product.Photo)" class="rounded">
                                </a>
                            </div>
                        </div>
                        <div class="col-sm-12 col-md-4 col-lg-5 d-flex justify-content-center justify-content-md-start">
                            <div id="carousel_info_container">
                                <h3>@product.Name</h3>
                                <p class="card-subtitle mb-2">@product.BrandName - @product.CategoryName</p>

                                @{
                                    var ratedScoreRounded = Math.Round(product.TotalRatingScore);
                                    var emptyStars = 5 - ratedScoreRounded;
                                    for (var j = 0; j < ratedScoreRounded; j++)
                                    {
                                        <i class="fas fa-star" style="color: gold"></i>
                                    }

                                    for (var j = 0; j < emptyStars; j++)
                                    {
                                        <i class="far fa-star" style="color: gold"></i>
                                    }
                                }

                                <span>@product.TotalRatingScore.ToString("0.0").Replace(',','.') / 5</span>
                                <br />
                                <a asp-controller="Product" asp-action="ProductDetail" asp-route-id="@product.Id" class="btn btn-info float-right float-md-left mt-md-2">Mer Info &raquo;</a>
                            </div>
                        </div>
                    </div>
                </div>
                a++;
            }
        }
    </div>

    <div class="d-none d-lg-block">
        <a class="carousel-control-prev" href="#rockstart-carousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only" style="color:gray">Previous</span>
        </a>
        <a class="carousel-control-next" href="#rockstart-carousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only" style="color:gray">Next</span>
        </a>
    </div>

</div>

<div class="container">
    <div class="row">
        @foreach (var item in Model)
        {
            @if (item.ActiveProduct != false && !User.IsInRole("Admin"))
            {
                <partial name="_Productpartial" model="item" />
            }

            @if (User.IsInRole("Admin"))
            {
                <partial name="_Productpartial" model="item" />
            }
        }
    </div>
    <div style="display: none" id="AntiForgeryToken">@GetAntiXsrfRequestToken()</div>
</div>
